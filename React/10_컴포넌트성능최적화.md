# ì»´í¬ë„ŒíŠ¸ ì„±ëŠ¥ ìµœì í™”

[TOC]

1. ë§ì€ ë°ì´í„° ë Œë”ë§í•˜ê¸°
2. í¬ë¡¬ ê°œë°œì ë„êµ¬ë¥¼ í†µí•œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
3. React.memoë¥¼ í†µí•œ ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§ ì„±ëŠ¥ ìµœì í™”
4. onToggleê³¼ onRemoveê°€ ìƒˆë¡œì›Œì§€ëŠ” í˜„ìƒ ë°©ì§€
5. react-virtualizedë¥¼ ì‚¬ìš©í•œ ë Œë”ë§ ìµœì í™”



## 01. ë§ì€ ë°ì´í„° ë Œë”ë§í•˜ê¸°

```react
// App.js

import { useState, useRef, useCallback } from 'react';
import TodoInsert from './components/TodoInsert';
import TodoList from './components/TodoList';
import TodoTemplate from './components/TodoTemplate';

function createBulkTodos() {
  const array = [];
  for (let i=1; i<=2500; i++) {
    array.push({
      id: i,
      text: `í• ì¼ ${i}`,
      checked: false
    });
  }
  return array;
}

const App = () => {
  const [todos, setTodos] = useState(createBulkTodos);

  // ê³ ìœ³ê°’ìœ¼ë¡œ ì‚¬ìš©ë  id
  // refë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ ë‹´ê¸°

  const nextId = useRef(2501);
  ...
};
 
export default App;
```

> useState(createBulkTodos) : ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë Œë”ë§ë  ë•Œë§Œ í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨
>
> useState(createBulkTodos()) : ë¦¬ë Œë”ë§ ë  ë•Œë§ˆë‹¤ createBulkTodos í•¨ìˆ˜ê°€ í˜¸ì¶œë¨



---



## 02. í¬ë¡¬ ê°œë°œì ë„êµ¬ë¥¼ í†µí•œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

- React DevTools : ì‹œê°„ ì¸¡ì •

- Profiler ì¢Œì¸¡ìƒë‹¨ íŒŒë€ìƒ‰ ë…¹í™”ë²„íŠ¼

- Render duration : ë¦¬ë Œë”ë§ì— ì†Œìš”ëœ ì‹œê°„ ( ì»´í“¨í„° í™˜ê²½ì— ë”°ë¼ )



## 03. ëŠë ¤ì§€ëŠ” ì›ì¸ ë¶„ì„

```
1. ìì‹ ì´ ì „ë‹¬ë°›ì€ propsê°€ ë³€ê²½ë  ë•Œ
2. ìì‹ ì˜ stateê°€ ë°”ë€” ë•Œ
3. ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œ
4. forceUpdate í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œ
```

- ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•œë‹¤. 



## 04. React.memoë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ì„±ëŠ¥ ìµœì í™”

âœ” `shouldComponentUpdate` ë¼ì´í”„ì‚¬ì´í´ì„ ì‚¬ìš©í•˜ë©´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ë¼ì´í”„ ì‚¬ì´í´ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•¨.

âœ” `React.memo`  : ì»´í¬ë„ŒíŠ¸ì˜ propsê°€ ë°”ë€Œì§€ ì•Šì•˜ë‹¤ë©´, ë¦¬ë Œë”ë§ í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ì—¬ í•¨ìˆ˜ì˜ ë¦¬ë Œë”ë§ ì„±ëŠ¥ì„ ìµœì í™”

```react
// TodoListItem.js

import React from 'react';
import {
    MdCheckBoxOutlineBlank,
    MdCheckBox,
    MdRemoveCircleOutline,
} from 'react-icons/md';
import cn from 'classnames';
import './TodoListItem.scss';


const TodoListItem = ({ todo, onRemove, onToggle }) => {
	(...)
};

export default React.memo(TodoListItem);
```





## 05. onToggle, onRemove í•¨ìˆ˜ê°€ ë°”ë€Œì§€ ì•Šê²Œ í•˜ê¸°

1. useStateì˜ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì‚¬ìš©
2. useReducer ì‚¬ìš©



### 05-1. useStateì˜ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸

âœ”**í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸** : ìƒˆë¡œìš´ ìƒíƒœë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„£ëŠ” ëŒ€ì‹ , ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ì–´ë–»ê²Œ í• ì§€ ì •ì˜í•´ ì£¼ëŠ” ì—…ë°ì´íŠ¸ í•¨ìˆ˜

```react
const [number, setNumber] = useState(0);

const onIncrese = useCallback(
	() => setNumber(prevNumber => prevNumber+1), 
    [],
);
```

```react
// App.js

import { useState, useRef, useCallback } from 'react';
import TodoInsert from './components/TodoInsert';
import TodoList from './components/TodoList';
import TodoTemplate from './components/TodoTemplate';

function createBulkTodos() {
  const array = [];
  for (let i=1; i<=2500; i++) {
    array.push({
      id: i,
      text: `í• ì¼ ${i}`,
      checked: false
    });
  }
  return array;
}

const App = () => {
  const [todos, setTodos] = useState(createBulkTodos);

  // ê³ ìœ³ê°’ìœ¼ë¡œ ì‚¬ìš©ë  id
  // refë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ ë‹´ê¸°
  const nextId = useRef(2501);

  const onInsert = useCallback(
    text => {
      const todo = {
        id: nextId.current,
        text,
        checked: false,
      };

      setTodos(todos => todos.concat(todo));
      nextId.current += 1;
    },
    [],
  );

  const onRemove = useCallback (
    id => {
      setTodos(todos => todos.filter(todo => todo.id !== id));
    }, [],
  );

  const onToggle = useCallback (
    id => {
      setTodos(todos =>
        todos.map(todo => 
        todo.id === id ? {...todo, checked: !todo.checked } : todo, ),
        );
    }, []
  );

  return (
  <TodoTemplate>
    <TodoInsert onInsert={onInsert}/>
    <TodoList todos={todos} onRemove={onRemove} onToggle={onToggle}/>
  </TodoTemplate>
  )
};

export default App;
```



### 05-2. useReducer ì‚¬ìš©í•˜ê¸°

```react
// App.js

import { useReducer, useRef, useCallback } from 'react';
import TodoInsert from './components/TodoInsert';
import TodoList from './components/TodoList';
import TodoTemplate from './components/TodoTemplate';

function createBulkTodos() {
  const array = [];
  for (let i=1; i<=2500; i++) {
    array.push({
      id: i,
      text: `í• ì¼ ${i}`,
      checked: false
    });
  }
  return array;
}


function todoReducer(todos, action) {
  switch (action.type) {
    case 'INSERT':
      return todos.concat(action.todo);
    case 'REMOVE':
      return todos.filter(todo => todo.id !== action.id);
    case 'TOGGLE':
      return todos.map(todo =>
        todo.id === action.id ? {...todo, checked: !todo.checked} : todo,);
    default:
      return todos;
  }
}

const App = () => {
  const [todos, dispatch] = useReducer(todoReducer, undefined, createBulkTodos);
  // ë‘ ë²ˆì§¸ ì¸ì: undefined, ì„¸ ë²ˆì§¸ ì¸ì: createBulkTodos
  // ì»´í¬ë„ŒíŠ¸ê°€ ë§¨ ì²˜ìŒ ë Œë”ë§ë  ë•Œë§Œ createBulkTodos í•¨ìˆ˜ê°€ í˜¸ì¶œë¨

  // ê³ ìœ³ê°’ìœ¼ë¡œ ì‚¬ìš©ë  id
  // refë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ ë‹´ê¸°
  const nextId = useRef(2501);

  const onInsert = useCallback(
    text => {
      const todo = {
        id: nextId.current,
        text,
        checked: false,
      };

      dispatch({ type: 'INSERT', todo })
      nextId.current += 1;
    },
    [],
  );

  const onRemove = useCallback (
    id => {
      dispatch({ type: 'REMOVE', id })
    }, [],
  );

  const onToggle = useCallback (
    id => {
      dispatch({ type: 'TOGGLE', id })
    }, []
  );

  return (
  <TodoTemplate>
    <TodoInsert onInsert={onInsert}/>
    <TodoList todos={todos} onRemove={onRemove} onToggle={onToggle}/>
  </TodoTemplate>
  )
};

export default App;
```

> useReducerë¥¼ ì‚¬ìš©í•  ë•Œ, ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ì´ˆê¸° ìƒíƒœë¥¼ ë„£ì–´ ì£¼ì–´ì•¼ í•¨.





## 06. ë¶ˆë³€ì˜ ì¤‘ìš”ì„±

```react
// App.js

const onToggle = useCallback (
    id => {
        setTodos(todos =>
                 todos.map(todo => 
                       todo.id === id ? {...todo, checked: !todo.checked } : todo, ),
                );
    }, []
);
```

> ê¸°ì¡´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•Œ, ì§ì ‘ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ë°°ì—´ì„ ë§Œë“  ë‹¤ìŒì— ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ í•„ìš”í•œ ë¶€ë¶„ì„ êµì²´í•˜ëŠ” ë°©ì‹

- **ë¶ˆë³€ì„±ì„ ì§€í‚¨ë‹¤** = ê¸°ì¡´ì˜ ê°’ì„ ì§ì ‘ ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë©´ì„œ ìƒˆë¡œìš´ ê°’ì„ ë§Œë“¤ì–´ë‚´ëŠ” ê²ƒ



```react
const array = [1, 2, 3, 4, 5];

const nextArrayBad = array;  // ë°°ì—´ì„ ë³µì‚¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë˜‘ê°™ì€ ë°°ì—´ì„ ê°€ë¦¬í‚´
nextArrayBad[0] = 100;
console.log(array === nextArrayBad);  // ë‘ ë°°ì—´ì€ ì™„ì „íˆ ê°™ì€ ë°°ì—´ì´ê¸° ë•Œë¬¸ì—, true


const nextArrayGood = [...array];   // ë°°ì—´ ë‚´ë¶€ì˜ ê°’ì„ ëª¨ë‘ ë³µì‚¬
nextArrayGood[0] = 100;
console.log(array === nextArrayGood);  // ì„œë¡œ ë‹¤ë¥¸ ë°°ì—´ì´ë¯€ë¡œ, false

const object = {
    foo: 'bar',
    value: 1
};

const nextObjectBad = object;   // ê°ì²´ê°€ ë³µì‚¬ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ ë˜‘ê°™ì€ ê°ì²´ë¥¼ ê°€ë¦¬í‚´
nextObjectBad.value = nextObjectBad.value + 1;
console.log(object === nextObjectBad);  // ë‘ ë°°ì—´ì€ ì™„ì „íˆ ê°™ì€ ë°°ì—´ì´ê¸° ë•Œë¬¸ì—, true


const nextObjectGood = {
    ...object,                // ê¸°ì¡´ì— ìˆë˜ ë‚´ìš©ì„ ëª¨ë‘ ë³µì‚¬í•´ì„œ ë„£ìŒ
    value: object.value + 1   // ìƒˆë¡œìš´ ê°’ ë®ì–´ì“°ê¸°
};   
console.log(object === nextObjectGood);  // ì„œë¡œ ë‹¤ë¥¸ ê°ì²´ì´ê¸° ë•Œë¬¸ì— false

```

- ë¶ˆë³€ì„±ì´ ì§€ì¼œì§€ì§€ ì•Šìœ¼ë©´ ê°ì²´ ë‚´ë¶€ì˜ ê°’ì´ ìƒˆë¡œì›Œì ¸ë„ ë°”ë€ ê²ƒì„ ê°ì§€í•˜ì§€ ëª»í•¨



â• ì „ê°œì—°ì‚°ì (...ë¬¸ë²•) ì„ ì‚¬ìš©í•˜ì—¬ ê°ì²´ë‚˜ ë°°ì—´ ë‚´ë¶€ì˜ ê°’ì„ ë³µì‚¬í•  ë•ŒëŠ” **ì–•ì€ ë³µì‚¬**

âœ” **ê¹Šì€ ë³µì‚¬í•˜ëŠ” ë°©ë²•**

```react
const nextComplexObject = {
	...complexObject,
    objectInside: {
        ...complexObject.objectInside,
        enabled: false
    }
};

console.log(complexObject === nextComplexObject); // false
console.log(complexObject.objectInside === nextComplexObject.objectInside); // false
```

> immer ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ìš© !



## 07. TodoList ì»´í¬ë„ŒíŠ¸ ìµœì í™”

```react
// TodoList.js

import React from "react";
import TodoListItem from "./TodoListItem";
import './TodoList.scss';

const TodoList = ({ todos, onRemove, onToggle }) => {
    return (
        ...
    )
};

export default React.memo(TodoList);
```

> í˜„ì¬ í”„ë¡œì íŠ¸ ì„±ëŠ¥ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ìµœì í™” ì½”ë“œ
>
> : TodoList ì»´í¬ë„ŒíŠ¸ì˜ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì¸ App ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë˜ëŠ” ìœ ì¼í•œ ì´ìœ ê°€ todos ë°°ì—´ì´ ì—…ë°ì´íŠ¸ë  ë•Œì´ê¸° ë•Œë¬¸.
>
> App ì»´í¬ë„ŒíŠ¸ì— ë‹¤ë¥¸ stateê°€ ì¶”ê°€ë˜ì–´ í•´ë‹¹ ê°’ë“¤ì´ ì—…ë°ì´íŠ¸ ë  ë•Œ TodoList ì»´í¬ë„ŒíŠ¸ê°€ ë¶ˆí•„ìš”í•œ ë Œë”ë§ì„ í•˜ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ React.memo ì‚¬ìš©



ğŸŒŸğŸŒŸ **ë¦¬ìŠ¤íŠ¸ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‘ì„±í•  ë•Œ** ğŸŒŸğŸŒŸ 

- ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œê³¼ ë¦¬ìŠ¤íŠ¸ | ë‘ê°€ì§€ ì»´í¬ë„ŒíŠ¸ ìµœì í™”í•˜ê¸°



## 08. react-virtualizedë¥¼ ì‚¬ìš©í•œ ë Œë”ë§ ìµœì í™”

- ìŠ¤í¬ë¡¤ë˜ê¸° ì „ì— ë³´ì´ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ë Œë”ë§í•˜ì§€ ì•Šê³  í¬ê¸°ë§Œ ì°¨ì§€í•˜ê²Œë” !
- ìŠ¤í¬ë¡¤ ì‹œ, í•´ë‹¹ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì—ì„œ ë³´ì—¬ì£¼ì–´ì•¼ í•  ì»´í¬ë„ŒíŠ¸ ë Œë”ë§



### 08-1. ì¤€ë¹„

```bash
$ yarn add react-virtualized
```

- ê° í•­ëª©ì˜ ì‹¤ì œ í¬ê¸°ë¥¼ px ë‹¨ìœ„ë¡œ ì•Œì•„ë‚´ê¸°



### 08-2. TodoList ìˆ˜ì •

```react
// TodoList.js

import React, { useCallback } from "react";
import { List } from 'react-virtualized';
import TodoListItem from "./TodoListItem";
import './TodoList.scss';

const TodoList = ({ todos, onRemove, onToggle }) => {

    const rowRenderer = useCallback(
        ({ index, key, style }) => {
            const todo = todos[index];
            return (
                <TodoListItem
                    todo={todo}
                    key={key}
                    onRemove={onRemove}
                    onToggle={onToggle}
                    style={style}
                />
            );
        }, [onRemove, onToggle, todos],
    );

    return (
        <List 
            className="TodoList"
            width={512}  // ì „ì²´ í¬ê¸°
            height={513} // ì „ì²´ ë†’ì´
            rowCount={todos.length}  // í•­ëª© ê°œìˆ˜
            rowHeight={57}  // í•­ëª© ë†’ì´
            rowRenderer={rowRenderer}  // í•­ëª©ì„ ë Œë”ë§í•  ë•Œ ì“°ëŠ” í•¨ìˆ˜
            list={todos}   // ë°°ì—´
            style={{outline: 'none'}}  // Listì— ê¸°ë³¸ ì ìš©ë˜ëŠ” outline ì œê±°
        />
    )
};

export default React.memo(TodoList);
```

> rowRenderer 
>
> : react-virtualizedì˜ List ì»´í¬ë„ŒíŠ¸ì—ì„œ ê° TodoItemì„ ë Œë”ë§í•  ë•Œ ì‚¬ìš©í•˜ë©°, ì´ í•¨ìˆ˜ë¥¼ List ì»´í¬ë„ŒíŠ¸ì˜ propsë¡œ ì„¤ì •í•´ì£¼ì–´ì•¼ í•¨.
>
> index, key, style ê°’ì„ ê°ì²´ íƒ€ì…ìœ¼ë¡œ ë°›ì•„ì™€ì„œ ì‚¬ìš©
>
> - List ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œ, í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ì˜ ì „ì²´ í¬ê¸°ì™€ ê° í•­ëª©ì˜ ë†’ì´, ê° í•­ëª©ì„ ë Œë”ë§í•  ë•Œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜, ê·¸ë¦¬ê³  ë°°ì—´ì„ propsë¡œ ë„£ì–´ì£¼ë©´ ì´ ì»´í¬ë„ŒíŠ¸ê°€ ì „ë‹¬ë°›ì€ propsë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ìµœì í™”



### 08-3. TodoListItem ìˆ˜ì •

```react
// TodoListItem.js - render

import React from 'react';
import {
    MdCheckBoxOutlineBlank,
    MdCheckBox,
    MdRemoveCircleOutline,
} from 'react-icons/md';
import cn from 'classnames';
import './TodoListItem.scss';


const TodoListItem = ({ todo, onRemove, onToggle, style }) => {
    const { id, text, checked } = todo;

    return (
        <div className="TodoListItem-virtualized" style={style}>
            <div className={cn("checkbox", { checked })} onClick={() => onToggle(id)}>
                {checked ? <MdCheckBox/> : <MdCheckBoxOutlineBlank/>}
                <div className="text">{text}</div>
            </div>
            <div className="remove" onClick={() => onRemove(id)}>
                <MdRemoveCircleOutline/>
            </div>
        </div>
    )
};

export default React.memo(TodoListItem);
```

```scss
// TodoListItem.scss

.TodoListItem-virtualized {
    & + & {
        border-top: 1px solid #dee2d6;
    }

    &:nth-child(even) {
        background: #f8f9fa;
    }
}

...
```

